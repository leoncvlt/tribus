var e=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable;import{D as n,U as a,H as r,F as i,a as o,R as l,b as c,L as h,c as u,d,N as p,P as m,S as f,B as g,M as v,e as w,f as x,g as b,h as y,E as M,V as T,i as E,T as S,Q as R,j as A,k as P,W as _,C as L,l as C,m as O,n as U,o as D,p as k,O as I,G as N,q as F,r as H,s as j,t as B,u as G,I as z,v as Y,w as K,x as V,y as W,z as X,A as q,J as Z,K as $,X as Q,Y as J,Z as ee,_ as te,$ as se,a0 as ne,a1 as ae,a2 as re,a3 as ie,a4 as oe,a5 as le,a6 as ce,a7 as he,a8 as ue,a9 as de,aa as pe,ab as me,ac as fe,ad as ge,ae as ve,af as we,ag as xe,ah as be,ai as ye,aj as Me,ak as Te,al as Ee,am as Se,an as Re,ao as Ae,ap as Pe,aq as _e,ar as Le,as as Ce,at as Oe,au as Ue,av as De,aw as ke,ax as Ie,ay as Ne,az as Fe,aA as He,aB as je,aC as Be,aD as Ge,aE as ze,aF as Ye,aG as Ke,aH as Ve}from"./three.a341a196.js";class We extends n{constructor(e){super(e),this.type=a}parse(e){const t=function(e,t){switch(e){case 1:console.error("THREE.RGBELoader Read Error: "+(t||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(t||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(t||""));break;default:case 4:console.error("THREE.RGBELoader: Error: "+(t||""))}return-1},s=function(e,t,s){t=t||1024;let n=e.pos,a=-1,r=0,i="",o=String.fromCharCode.apply(null,new Uint16Array(e.subarray(n,n+128)));for(;0>(a=o.indexOf("\n"))&&r<t&&n<e.byteLength;)i+=o,r+=o.length,n+=128,o+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(n,n+128)));return-1<a&&(!1!==s&&(e.pos+=r+a+1),i+o.slice(0,a))},n=function(e,t,s,n){const a=e[t+3],r=Math.pow(2,a-128)/255;s[n+0]=e[t+0]*r,s[n+1]=e[t+1]*r,s[n+2]=e[t+2]*r},h=function(e,t,s,n){const a=e[t+3],r=Math.pow(2,a-128)/255;s[n+0]=o.toHalfFloat(e[t+0]*r),s[n+1]=o.toHalfFloat(e[t+1]*r),s[n+2]=o.toHalfFloat(e[t+2]*r)},u=new Uint8Array(e);u.pos=0;const d=function(e){const n=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,a=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,r=/^\s*FORMAT=(\S+)\s*$/,i=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,o={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let l,c;if(e.pos>=e.byteLength||!(l=s(e)))return t(1,"no header found");if(!(c=l.match(/^#\?(\S+)/)))return t(3,"bad initial token");for(o.valid|=1,o.programtype=c[1],o.string+=l+"\n";l=s(e),!1!==l;)if(o.string+=l+"\n","#"!==l.charAt(0)){if((c=l.match(n))&&(o.gamma=parseFloat(c[1],10)),(c=l.match(a))&&(o.exposure=parseFloat(c[1],10)),(c=l.match(r))&&(o.valid|=2,o.format=c[1]),(c=l.match(i))&&(o.valid|=4,o.height=parseInt(c[1],10),o.width=parseInt(c[2],10)),2&o.valid&&4&o.valid)break}else o.comments+=l+"\n";return 2&o.valid?4&o.valid?o:t(3,"missing image size specifier"):t(3,"missing format specifier")}(u);if(-1!==d){const e=d.width,s=d.height,o=function(e,s,n){const a=s;if(a<8||a>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);if(a!==(e[2]<<8|e[3]))return t(3,"wrong scanline width");const r=new Uint8Array(4*s*n);if(!r.length)return t(4,"unable to allocate buffer space");let i=0,o=0;const l=4*a,c=new Uint8Array(4),h=new Uint8Array(l);let u=n;for(;u>0&&o<e.byteLength;){if(o+4>e.byteLength)return t(1);if(c[0]=e[o++],c[1]=e[o++],c[2]=e[o++],c[3]=e[o++],2!=c[0]||2!=c[1]||(c[2]<<8|c[3])!=a)return t(3,"bad rgbe scanline format");let s,n=0;for(;n<l&&o<e.byteLength;){s=e[o++];const a=s>128;if(a&&(s-=128),0===s||n+s>l)return t(3,"bad scanline data");if(a){const t=e[o++];for(let e=0;e<s;e++)h[n++]=t}else h.set(e.subarray(o,o+s),n),n+=s,o+=s}const d=a;for(let e=0;e<d;e++){let t=0;r[i]=h[e+t],t+=a,r[i+1]=h[e+t],t+=a,r[i+2]=h[e+t],t+=a,r[i+3]=h[e+t],i+=4}u--}return r}(u.subarray(u.pos),e,s);if(-1!==o){let t,u,p,m;switch(this.type){case a:t=o,u=c,p=a;break;case i:m=o.length/4*3;const e=new Float32Array(m);for(let t=0;t<m;t++)n(o,4*t,e,3*t);t=e,u=l,p=i;break;case r:m=o.length/4*3;const s=new Uint16Array(m);for(let t=0;t<m;t++)h(o,4*t,s,3*t);t=s,u=l,p=r;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:e,height:s,data:t,header:d.string,gamma:d.gamma,exposure:d.exposure,format:u,type:p}}}return null}setDataType(e){return this.type=e,this}load(e,t,s,n){return super.load(e,(function(e,s){switch(e.type){case a:e.encoding=d,e.minFilter=p,e.magFilter=p,e.generateMipmaps=!1,e.flipY=!0;break;case i:case r:e.encoding=h,e.minFilter=u,e.magFilter=u,e.generateMipmaps=!1,e.flipY=!0}t&&t(e,s)}),s,n)}}class Xe{constructor(e,t,{texture:s,equirectangular:n,cubemap:a,background:r}={}){this.pmremGenerator=new m(e),this.renderer=e,this.scene=t,this.apply({texture:s,equirectangular:n,cubemap:a,background:r})}async apply({texture:e=null,equirectangular:t=!1,cubemap:s=!1,background:n=!1}={}){e||(e=this.pmremGenerator.fromScene(new qe).texture),("string"==typeof e||e instanceof String)&&(e=await(new RGBELoader).loadAsync(e),this.renderer.initTexture(e)),t&&(e=this.pmremGenerator.fromEquirectangular(e).texture),s&&(e=this.pmremGenerator.fromCubemap(e).texture),this.scene.environment=e,n&&(this.scene.background=e)}}class qe extends f{constructor(){super();const e=new g;e.deleteAttribute("uv");const t=new v({side:w}),s=new v,n=new x(16777215,5,28,2);n.position.set(.418,16.199,.3),this.add(n);const a=new b(e,t);a.position.set(-.757,13.219,.717),a.scale.set(31.713,28.305,28.591),this.add(a);const r=new b(e,s);r.position.set(-10.906,2.009,1.846),r.rotation.set(0,-.195,0),r.scale.set(2.328,7.905,4.651),this.add(r);const i=new b(e,s);i.position.set(-5.607,-.754,-.758),i.rotation.set(0,.994,0),i.scale.set(1.97,1.534,3.955),this.add(i);const o=new b(e,s);o.position.set(6.167,.857,7.803),o.rotation.set(0,.561,0),o.scale.set(3.927,6.285,3.687),this.add(o);const l=new b(e,s);l.position.set(-2.017,.018,6.124),l.rotation.set(0,.333,0),l.scale.set(2.002,4.566,2.064),this.add(l);const c=new b(e,s);c.position.set(2.291,-.756,-2.621),c.rotation.set(0,-.286,0),c.scale.set(1.546,1.552,1.496),this.add(c);const h=new b(e,s);h.position.set(-2.193,-.369,-5.547),h.rotation.set(0,.516,0),h.scale.set(3.875,3.487,2.986),this.add(h);const u=new b(e,this.createAreaLightMaterial(50));u.position.set(-16.116,14.37,8.208),u.scale.set(.1,2.428,2.739),this.add(u);const d=new b(e,this.createAreaLightMaterial(50));d.position.set(-16.109,18.021,-8.207),d.scale.set(.1,2.425,2.751),this.add(d);const p=new b(e,this.createAreaLightMaterial(17));p.position.set(14.904,12.198,-1.832),p.scale.set(.15,4.265,6.331),this.add(p);const m=new b(e,this.createAreaLightMaterial(43));m.position.set(-.462,8.89,14.52),m.scale.set(4.38,5.441,.088),this.add(m);const f=new b(e,this.createAreaLightMaterial(20));f.position.set(3.235,11.486,-12.541),f.scale.set(2.5,2,.1),this.add(f);const y=new b(e,this.createAreaLightMaterial(100));y.position.set(0,20,0),y.scale.set(1,.1,1),this.add(y)}createAreaLightMaterial(e){const t=new y;return t.color.setScalar(e),t}}const Ze={type:"change"},$e={type:"start"},Qe={type:"end"};class Je extends M{constructor(e,t){super(),void 0===t&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=t,this.enabled=!0,this.target=new T,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:E.ROTATE,MIDDLE:E.DOLLY,RIGHT:E.PAN},this.touches={ONE:S.ROTATE,TWO:S.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return i.phi},this.getAzimuthalAngle=function(){return i.theta},this.listenToKeyEvents=function(e){e.addEventListener("keydown",V),this._domElementKeyEvents=e},this.saveState=function(){s.target0.copy(s.target),s.position0.copy(s.object.position),s.zoom0=s.object.zoom},this.reset=function(){s.target.copy(s.target0),s.object.position.copy(s.position0),s.object.zoom=s.zoom0,s.object.updateProjectionMatrix(),s.dispatchEvent(Ze),s.update(),a=n.NONE},this.update=function(){const t=new T,u=(new R).setFromUnitVectors(e.up,new T(0,1,0)),d=u.clone().invert(),p=new T,m=new R,f=2*Math.PI;return function(){const e=s.object.position;t.copy(e).sub(s.target),t.applyQuaternion(u),i.setFromVector3(t),s.autoRotate&&a===n.NONE&&y(2*Math.PI/60/60*s.autoRotateSpeed),s.enableDamping?(i.theta+=o.theta*s.dampingFactor,i.phi+=o.phi*s.dampingFactor):(i.theta+=o.theta,i.phi+=o.phi);let g=s.minAzimuthAngle,v=s.maxAzimuthAngle;return isFinite(g)&&isFinite(v)&&(g<-Math.PI?g+=f:g>Math.PI&&(g-=f),v<-Math.PI?v+=f:v>Math.PI&&(v-=f),i.theta=g<=v?Math.max(g,Math.min(v,i.theta)):i.theta>(g+v)/2?Math.max(g,i.theta):Math.min(v,i.theta)),i.phi=Math.max(s.minPolarAngle,Math.min(s.maxPolarAngle,i.phi)),i.makeSafe(),i.radius*=l,i.radius=Math.max(s.minDistance,Math.min(s.maxDistance,i.radius)),!0===s.enableDamping?s.target.addScaledVector(c,s.dampingFactor):s.target.add(c),t.setFromSpherical(i),t.applyQuaternion(d),e.copy(s.target).add(t),s.object.lookAt(s.target),!0===s.enableDamping?(o.theta*=1-s.dampingFactor,o.phi*=1-s.dampingFactor,c.multiplyScalar(1-s.dampingFactor)):(o.set(0,0,0),c.set(0,0,0)),l=1,!!(h||p.distanceToSquared(s.object.position)>r||8*(1-m.dot(s.object.quaternion))>r)&&(s.dispatchEvent(Ze),p.copy(s.object.position),m.copy(s.object.quaternion),h=!1,!0)}}(),this.dispose=function(){s.domElement.removeEventListener("contextmenu",Z),s.domElement.removeEventListener("pointerdown",G),s.domElement.removeEventListener("wheel",K),s.domElement.removeEventListener("touchstart",W),s.domElement.removeEventListener("touchend",q),s.domElement.removeEventListener("touchmove",X),s.domElement.ownerDocument.removeEventListener("pointermove",z),s.domElement.ownerDocument.removeEventListener("pointerup",Y),null!==s._domElementKeyEvents&&s._domElementKeyEvents.removeEventListener("keydown",V)};const s=this,n={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let a=n.NONE;const r=1e-6,i=new A,o=new A;let l=1;const c=new T;let h=!1;const u=new P,d=new P,p=new P,m=new P,f=new P,g=new P,v=new P,w=new P,x=new P;function b(){return Math.pow(.95,s.zoomSpeed)}function y(e){o.theta-=e}function M(e){o.phi-=e}const _=function(){const e=new T;return function(t,s){e.setFromMatrixColumn(s,0),e.multiplyScalar(-t),c.add(e)}}(),L=function(){const e=new T;return function(t,n){!0===s.screenSpacePanning?e.setFromMatrixColumn(n,1):(e.setFromMatrixColumn(n,0),e.crossVectors(s.object.up,e)),e.multiplyScalar(t),c.add(e)}}(),C=function(){const e=new T;return function(t,n){const a=s.domElement;if(s.object.isPerspectiveCamera){const r=s.object.position;e.copy(r).sub(s.target);let i=e.length();i*=Math.tan(s.object.fov/2*Math.PI/180),_(2*t*i/a.clientHeight,s.object.matrix),L(2*n*i/a.clientHeight,s.object.matrix)}else s.object.isOrthographicCamera?(_(t*(s.object.right-s.object.left)/s.object.zoom/a.clientWidth,s.object.matrix),L(n*(s.object.top-s.object.bottom)/s.object.zoom/a.clientHeight,s.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),s.enablePan=!1)}}();function O(e){s.object.isPerspectiveCamera?l/=e:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom*e)),s.object.updateProjectionMatrix(),h=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function U(e){s.object.isPerspectiveCamera?l*=e:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom/e)),s.object.updateProjectionMatrix(),h=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function D(e){u.set(e.clientX,e.clientY)}function k(e){m.set(e.clientX,e.clientY)}function I(e){if(1==e.touches.length)u.set(e.touches[0].pageX,e.touches[0].pageY);else{const t=.5*(e.touches[0].pageX+e.touches[1].pageX),s=.5*(e.touches[0].pageY+e.touches[1].pageY);u.set(t,s)}}function N(e){if(1==e.touches.length)m.set(e.touches[0].pageX,e.touches[0].pageY);else{const t=.5*(e.touches[0].pageX+e.touches[1].pageX),s=.5*(e.touches[0].pageY+e.touches[1].pageY);m.set(t,s)}}function F(e){const t=e.touches[0].pageX-e.touches[1].pageX,s=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+s*s);v.set(0,n)}function H(e){if(1==e.touches.length)d.set(e.touches[0].pageX,e.touches[0].pageY);else{const t=.5*(e.touches[0].pageX+e.touches[1].pageX),s=.5*(e.touches[0].pageY+e.touches[1].pageY);d.set(t,s)}p.subVectors(d,u).multiplyScalar(s.rotateSpeed);const t=s.domElement;y(2*Math.PI*p.x/t.clientHeight),M(2*Math.PI*p.y/t.clientHeight),u.copy(d)}function j(e){if(1==e.touches.length)f.set(e.touches[0].pageX,e.touches[0].pageY);else{const t=.5*(e.touches[0].pageX+e.touches[1].pageX),s=.5*(e.touches[0].pageY+e.touches[1].pageY);f.set(t,s)}g.subVectors(f,m).multiplyScalar(s.panSpeed),C(g.x,g.y),m.copy(f)}function B(e){const t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,a=Math.sqrt(t*t+n*n);w.set(0,a),x.set(0,Math.pow(w.y/v.y,s.zoomSpeed)),O(x.y),v.copy(w)}function G(e){if(!1!==s.enabled)switch(e.pointerType){case"mouse":case"pen":!function(e){let t;switch(e.preventDefault(),s.domElement.focus?s.domElement.focus():window.focus(),e.button){case 0:t=s.mouseButtons.LEFT;break;case 1:t=s.mouseButtons.MIDDLE;break;case 2:t=s.mouseButtons.RIGHT;break;default:t=-1}switch(t){case E.DOLLY:if(!1===s.enableZoom)return;!function(e){v.set(e.clientX,e.clientY)}(e),a=n.DOLLY;break;case E.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===s.enablePan)return;k(e),a=n.PAN}else{if(!1===s.enableRotate)return;D(e),a=n.ROTATE}break;case E.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===s.enableRotate)return;D(e),a=n.ROTATE}else{if(!1===s.enablePan)return;k(e),a=n.PAN}break;default:a=n.NONE}a!==n.NONE&&(s.domElement.ownerDocument.addEventListener("pointermove",z),s.domElement.ownerDocument.addEventListener("pointerup",Y),s.dispatchEvent($e))}(e)}}function z(e){if(!1!==s.enabled)switch(e.pointerType){case"mouse":case"pen":!function(e){if(!1===s.enabled)return;switch(e.preventDefault(),a){case n.ROTATE:if(!1===s.enableRotate)return;!function(e){d.set(e.clientX,e.clientY),p.subVectors(d,u).multiplyScalar(s.rotateSpeed);const t=s.domElement;y(2*Math.PI*p.x/t.clientHeight),M(2*Math.PI*p.y/t.clientHeight),u.copy(d),s.update()}(e);break;case n.DOLLY:if(!1===s.enableZoom)return;!function(e){w.set(e.clientX,e.clientY),x.subVectors(w,v),x.y>0?O(b()):x.y<0&&U(b()),v.copy(w),s.update()}(e);break;case n.PAN:if(!1===s.enablePan)return;!function(e){f.set(e.clientX,e.clientY),g.subVectors(f,m).multiplyScalar(s.panSpeed),C(g.x,g.y),m.copy(f),s.update()}(e)}}(e)}}function Y(e){switch(e.pointerType){case"mouse":case"pen":!function(e){if(s.domElement.ownerDocument.removeEventListener("pointermove",z),s.domElement.ownerDocument.removeEventListener("pointerup",Y),!1===s.enabled)return;s.dispatchEvent(Qe),a=n.NONE}()}}function K(e){!1===s.enabled||!1===s.enableZoom||a!==n.NONE&&a!==n.ROTATE||(e.preventDefault(),s.dispatchEvent($e),function(e){e.deltaY<0?U(b()):e.deltaY>0&&O(b()),s.update()}(e),s.dispatchEvent(Qe))}function V(e){!1!==s.enabled&&!1!==s.enablePan&&function(e){let t=!1;switch(e.code){case s.keys.UP:C(0,s.keyPanSpeed),t=!0;break;case s.keys.BOTTOM:C(0,-s.keyPanSpeed),t=!0;break;case s.keys.LEFT:C(s.keyPanSpeed,0),t=!0;break;case s.keys.RIGHT:C(-s.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),s.update())}(e)}function W(e){if(!1!==s.enabled){switch(e.preventDefault(),e.touches.length){case 1:switch(s.touches.ONE){case S.ROTATE:if(!1===s.enableRotate)return;I(e),a=n.TOUCH_ROTATE;break;case S.PAN:if(!1===s.enablePan)return;N(e),a=n.TOUCH_PAN;break;default:a=n.NONE}break;case 2:switch(s.touches.TWO){case S.DOLLY_PAN:if(!1===s.enableZoom&&!1===s.enablePan)return;!function(e){s.enableZoom&&F(e),s.enablePan&&N(e)}(e),a=n.TOUCH_DOLLY_PAN;break;case S.DOLLY_ROTATE:if(!1===s.enableZoom&&!1===s.enableRotate)return;!function(e){s.enableZoom&&F(e),s.enableRotate&&I(e)}(e),a=n.TOUCH_DOLLY_ROTATE;break;default:a=n.NONE}break;default:a=n.NONE}a!==n.NONE&&s.dispatchEvent($e)}}function X(e){if(!1!==s.enabled)switch(e.preventDefault(),a){case n.TOUCH_ROTATE:if(!1===s.enableRotate)return;H(e),s.update();break;case n.TOUCH_PAN:if(!1===s.enablePan)return;j(e),s.update();break;case n.TOUCH_DOLLY_PAN:if(!1===s.enableZoom&&!1===s.enablePan)return;!function(e){s.enableZoom&&B(e),s.enablePan&&j(e)}(e),s.update();break;case n.TOUCH_DOLLY_ROTATE:if(!1===s.enableZoom&&!1===s.enableRotate)return;!function(e){s.enableZoom&&B(e),s.enableRotate&&H(e)}(e),s.update();break;default:a=n.NONE}}function q(e){!1!==s.enabled&&(s.dispatchEvent(Qe),a=n.NONE)}function Z(e){!1!==s.enabled&&e.preventDefault()}s.domElement.addEventListener("contextmenu",Z),s.domElement.addEventListener("pointerdown",G),s.domElement.addEventListener("wheel",K,{passive:!1}),s.domElement.addEventListener("touchstart",W,{passive:!1}),s.domElement.addEventListener("touchend",q),s.domElement.addEventListener("touchmove",X,{passive:!1}),this.update()}}class et{get parameters(){return{}}constructor({gui:e}){this.renderer=new _({canvas:document.querySelector("canvas"),antialias:!0}),this.clock=new L,this.scene=new f,this.scene.background=new C(16777215),this.camera=new O,this.controls=new Je(this.camera,this.renderer.domElement),this.controls.enableDamping=!0,this._start(),this.gui=e}async _start(){await this.start(),this._params={};const n=Object.entries(this.parameters);n.length?n.forEach((n=>{var[a,r]=n,i=r,{value:o,onChange:l}=i,c=((n,a)=>{var r={};for(var i in n)t.call(n,i)&&a.indexOf(i)<0&&(r[i]=n[i]);if(null!=n&&e)for(var i of e(n))a.indexOf(i)<0&&s.call(n,i)&&(r[i]=n[i]);return r})(i,["value","onChange"]);this._params[a]=o;this.gui.addInput(this._params,a,c).on("change",(({value:e})=>l(e)))})):this.gui.dispose(),this.controls&&this.renderer.domElement.classList.add("controls"),this._update()}_update(){const e=this.renderer.domElement,t=e.clientWidth,s=e.clientHeight;(e.width!==t||e.height!==s)&&(this.renderer.setSize(t,s,!1),this.camera.aspect=e.clientWidth/e.clientHeight,this.camera.updateProjectionMatrix());const n=this.clock.getDelta(),a=this.clock.getElapsedTime();this.update&&this.update(n,a),this.controls.update(),this.renderer.render(this.scene,this.camera),requestAnimationFrame(this._update.bind(this))}}var tt="./assets/venice_sunset_1k.0e72ed46.hdr";var st={uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform float h;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 sum = vec4( 0.0 );\n\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;\n\n\t\t\tgl_FragColor = sum;\n\n\t\t}"};const nt={uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform float v;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 sum = vec4( 0.0 );\n\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;\n\n\t\t\tgl_FragColor = sum;\n\n\t\t}"};class at extends b{set opacity(e){this.planeMaterial.opacity=e}get opacity(){return this.planeMaterial.opacity}set darkness(e){this._depthShader.uniforms.darkness.value=e}get darkness(){var e;return(null==(e=this._depthShader)?void 0:e.uniforms.darkness.value)||1}constructor({width:e=16,height:t=16,textureWidth:s=512,textureHeight:n=512,cameraHeight:a=16,darkness:r=1,opacity:i=1,blur:o=4,fastBlur:l=!1,manualRender:c=!1}={}){super(),this.textureWidth=s,this.textureHeight=n,this.blur=o,this.fastBlur=l,this.manualRender=c,this.renderTarget=new D(s,n),this.renderTarget.texture.generateMipmaps=!1,this.renderTargetBlur=new D(s,n),this.renderTargetBlur.texture.generateMipmaps=!1;const h=new k(e,t).rotateX(Math.PI/2);this.planeMaterial=new y({map:this.renderTarget.texture,opacity:i,transparent:!0,depthWrite:!1});const u=new b(h,this.planeMaterial);u.renderOrder=1,u.scale.y=-1,this.add(u),this.blurPlane=new b(h),this.blurPlane.visible=!1,this.add(this.blurPlane),this.shadowCamera=new I(-e/2,e/2,t/2,-t/2,0,a),this.shadowCamera.rotation.x=Math.PI/2,this.add(this.shadowCamera),this.helpers=new N;const d=new F(this.shadowCamera);this.helpers.add(d),this.depthMaterial=new H,this.depthMaterial.onBeforeCompile=e=>{e.uniforms.darkness={value:r},e.fragmentShader=`\n\t\t\t\t\t\tuniform float darkness;\n\t\t\t\t\t\t${e.fragmentShader.replace("gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );","gl_FragColor = vec4( vec3( 0.0 ), ( 1.0 - fragCoordZ ) * darkness );")}\n\t\t\t\t\t`,this._depthShader=e},this.depthMaterial.depthTest=!1,this.depthMaterial.depthWrite=!1,this.horizontalBlurMaterial=new j(st),this.horizontalBlurMaterial.depthTest=!1,this.verticalBlurMaterial=new j(nt),this.verticalBlurMaterial.depthTest=!1}blurShadow(e,t){this.blurPlane.visible=!0,this.blurPlane.material=this.horizontalBlurMaterial,this.blurPlane.material.uniforms.tDiffuse.value=this.renderTarget.texture,this.horizontalBlurMaterial.uniforms.h.value=1*t/this.textureWidth,e.setRenderTarget(this.renderTargetBlur),e.render(this.blurPlane,this.shadowCamera),this.blurPlane.material=this.verticalBlurMaterial,this.blurPlane.material.uniforms.tDiffuse.value=this.renderTargetBlur.texture,this.verticalBlurMaterial.uniforms.v.value=1*t/this.textureHeight,e.setRenderTarget(this.renderTarget),e.render(this.blurPlane,this.shadowCamera),this.blurPlane.visible=!1}onBeforeRender(e,t,s){this.manualRender||this.render(e,t)}render(e,t){const s=t.background;t.background=null,this.helpers.visible=!1,t.overrideMaterial=this.depthMaterial,e.setRenderTarget(this.renderTarget),e.render(t,this.shadowCamera),t.overrideMaterial=null,this.helpers.visible=!0,this.blurShadow(e,this.blur),this.fastBlur||this.blurShadow(e,.4*this.blur),e.setRenderTarget(null),t.background=s}}var rt={uniforms:{color:{value:null},map:{value:null},opacity:{value:1},textureMatrix:{value:null}},vertexShader:"\n    uniform mat4 textureMatrix;\n    varying vec4 vUv;\n    void main() {\n      vUv = textureMatrix * vec4( position, 1.0 );\n      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n    }\n  ",fragmentShader:"\n    uniform vec3 color;\n    uniform sampler2D map;\n    uniform float opacity;\n    varying vec4 vUv;\n    void main() {\n      vec4 base = texture2DProj( map, vUv );\n      gl_FragColor = vec4(base.rgb * color, base.a * opacity );\n      gl_FragColor.rgb *= opacity;\n    }\n  "};class it extends b{set opacity(e){this.material.uniforms.opacity.value=e}get opacity(){return this.material.uniforms.opacity.value}constructor({geometry:e,width:t=32,height:s=32,textureWidth:n=512,textureHeight:a=512,color:r=16777215,clipBias:i=0,opacity:o=1,blur:l=0,fastBlur:c=!1,manualRender:h=!1,excluded:d=[]}={}){e?super(e):(super(new k(t,s)),this.rotation.x=-Math.PI/2),this.type="Reflector",this.textureWidth=n,this.textureHeight=a,this.excluded=d,this.blur=l,this.fastBlur=c,this.clipBias=i,this.manualRender=h,this.reflectorPlane=new Y,this.normal=new T,this.reflectorWorldPosition=new T,this.cameraWorldPosition=new T,this.rotationMatrix=new K,this.lookAtPosition=new T(0,0,-1),this.clipPlane=new V,this.view=new T,this.target=new T,this.q=new V,this.textureMatrix=new K,this.virtualCamera=new O,this.renderTarget=new D(n,a,{minFilter:u,magFilter:u,format:W}),X.isPowerOfTwo(n)&&X.isPowerOfTwo(a)||(this.renderTarget.texture.generateMipmaps=!1),this.renderTargetBlur=this.renderTarget.clone(),this.renderTargetBlur.texture.generateMipmaps=!1;const p=rt,m=new j({uniforms:q.clone(p.uniforms),fragmentShader:p.fragmentShader,vertexShader:p.vertexShader});this.material=m,this.material.uniforms.textureMatrix.value=this.textureMatrix,this.material.uniforms.map.value=this.renderTarget.texture,this.material.uniforms.color.value=new C(r),this.material.uniforms.opacity.value=o,this.material.transparent=!0,this.material.depthWrite=!1,this.material.premultipliedAlpha=!0,this.horizontalBlurMaterial=new j(st),this.verticalBlurMaterial=new j(nt),this.screenScene=new f,this.screenCamera=new I(-1,1,1,-1,0,1),this.screenGeometry=new Z;const g=new Float32Array([-1,-1,3,-1,-1,3]),v=new Float32Array([0,0,2,0,0,2]);this.screenGeometry.setAttribute("position",new $(g,2)),this.screenGeometry.setAttribute("uv",new $(v,2)),this.screen=new b(this.screenGeometry),this.screen.frustumCulled=!1,this.screenScene.add(this.screen)}onBeforeRender(e,t,s){this.manualRender||this.render(e,t,s)}render(e,t,s){if(this.reflectorWorldPosition.setFromMatrixPosition(this.matrixWorld),this.cameraWorldPosition.setFromMatrixPosition(s.matrixWorld),this.rotationMatrix.extractRotation(this.matrixWorld),this.normal.set(0,0,1),this.normal.applyMatrix4(this.rotationMatrix),this.view.subVectors(this.reflectorWorldPosition,this.cameraWorldPosition),this.view.dot(this.normal)>0)return;this.view.reflect(this.normal).negate(),this.view.add(this.reflectorWorldPosition),this.rotationMatrix.extractRotation(s.matrixWorld),this.lookAtPosition.set(0,0,-1),this.lookAtPosition.applyMatrix4(this.rotationMatrix),this.lookAtPosition.add(this.cameraWorldPosition),this.target.subVectors(this.reflectorWorldPosition,this.lookAtPosition),this.target.reflect(this.normal).negate(),this.target.add(this.reflectorWorldPosition),this.virtualCamera.position.copy(this.view),this.virtualCamera.up.set(0,1,0),this.virtualCamera.up.applyMatrix4(this.rotationMatrix),this.virtualCamera.up.reflect(this.normal),this.virtualCamera.lookAt(this.target),this.virtualCamera.far=s.far,this.virtualCamera.updateMatrixWorld(),this.virtualCamera.projectionMatrix.copy(s.projectionMatrix),this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.virtualCamera.projectionMatrix),this.textureMatrix.multiply(this.virtualCamera.matrixWorldInverse),this.textureMatrix.multiply(this.matrixWorld),this.reflectorPlane.setFromNormalAndCoplanarPoint(this.normal,this.reflectorWorldPosition),this.reflectorPlane.applyMatrix4(this.virtualCamera.matrixWorldInverse),this.clipPlane.set(this.reflectorPlane.normal.x,this.reflectorPlane.normal.y,this.reflectorPlane.normal.z,this.reflectorPlane.constant);const n=this.virtualCamera.projectionMatrix;this.q.x=(Math.sign(this.clipPlane.x)+n.elements[8])/n.elements[0],this.q.y=(Math.sign(this.clipPlane.y)+n.elements[9])/n.elements[5],this.q.z=-1,this.q.w=(1+n.elements[10])/n.elements[14],this.clipPlane.multiplyScalar(2/this.clipPlane.dot(this.q)),n.elements[2]=this.clipPlane.x,n.elements[6]=this.clipPlane.y,n.elements[10]=this.clipPlane.z+1-this.clipBias,n.elements[14]=this.clipPlane.w,this.visible=!1,this.excluded.forEach((e=>e.visible=!1));const a=t.background,r=e.getRenderTarget(),i=e.xr.enabled,o=e.shadowMap.autoUpdate;t.background=null,e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(this.renderTarget),e.state.buffers.depth.setMask(!0),!1===e.autoClear&&e.clear(),e.render(t,this.virtualCamera),this.blur>0&&(this.blurReflector(e,this.blur),this.fastBlur||this.blurReflector(e,.4*this.blur)),e.xr.enabled=i,e.shadowMap.autoUpdate=o,t.background=a,e.setRenderTarget(r),this.excluded.forEach((e=>e.visible=!0)),this.visible=!0}blurReflector(e,t){this.horizontalBlurMaterial.uniforms.tDiffuse.value=this.renderTarget.texture,this.horizontalBlurMaterial.uniforms.h.value=1*t/this.textureWidth,this.screen.material=this.horizontalBlurMaterial,e.setRenderTarget(this.renderTargetBlur),!1===e.autoClear&&e.clear(),e.render(this.screenScene,this.screenCamera),this.verticalBlurMaterial.uniforms.tDiffuse.value=this.renderTargetBlur.texture,this.verticalBlurMaterial.uniforms.v.value=1*t/this.textureHeight,this.screen.material=this.verticalBlurMaterial,e.setRenderTarget(this.renderTarget),!1===e.autoClear&&e.clear(),e.render(this.screenScene,this.screenCamera)}}it.prototype.isReflector=!0;class ot{constructor(e,t=1024){this.renderer=e,this.res=t,this.lightMapContainers=[],this.compiled=!1,this.scene=new f,this.scene.background=null,this.tinyTarget=new D(1,1),this.buffer1Active=!1,this.firstUpdate=!0,this.warned=!1;const s=/(Android|iPad|iPhone|iPod)/g.test(navigator.userAgent)?r:i;this.progressiveLightMap1=new D(this.res,this.res,{type:s}),this.progressiveLightMap2=new D(this.res,this.res,{type:s}),this.uvMat=new Q,this.uvMat.uniforms={},this.uvMat.onBeforeCompile=e=>{e.vertexShader="#define USE_LIGHTMAP\n"+e.vertexShader.slice(0,-1)+"\tgl_Position = vec4((uv2 - 0.5) * 2.0, 1.0, 1.0); }";const t=e.fragmentShader.indexOf("void main() {");e.fragmentShader="varying vec2 vUv2;\n"+e.fragmentShader.slice(0,t)+"\tuniform sampler2D previousShadowMap;\n\tuniform float averagingWindow;\n"+e.fragmentShader.slice(t-1,-1)+"\nvec3 texelOld = texture2D(previousShadowMap, vUv2).rgb;\n\t\t\t\tgl_FragColor.rgb = mix(texelOld, gl_FragColor.rgb, 1.0/averagingWindow);\n\t\t\t}",e.uniforms.previousShadowMap={value:this.progressiveLightMap1.texture},e.uniforms.averagingWindow={value:100},this.uvMat.uniforms=e.uniforms,this.uvMat.userData.shader=e,this.compiled=!0}}addObjectsToLightMap(e){this.uv_boxes=[];const t=3/this.res;for(let n=0;n<e.length;n++){const s=e[n];s.isLight?this.scene.attach(s):s.geometry.hasAttribute("uv")?(null==this.blurringPlane&&this._initializeBlurPlane(this.res,this.progressiveLightMap1),s.material.lightMap=this.progressiveLightMap2.texture,s.material.dithering=!0,s.castShadow=!0,s.receiveShadow=!0,s.renderOrder=1e3+n,this.uv_boxes.push({w:1+2*t,h:1+2*t,index:n}),this.lightMapContainers.push({basicMat:s.material,object:s}),this.compiled=!1):console.warn("All lightmap objects need UVs!")}const s=
/**
 * potpack - by [@mourner](https://github.com/mourner)
 * 
 * A tiny JavaScript function for packing 2D rectangles into a near-square container, 
 * which is useful for generating CSS sprites and WebGL textures. Similar to 
 * [shelf-pack](https://github.com/mapbox/shelf-pack), but static (you can't add items 
 * once a layout is generated), and aims for maximal space utilization.
 *
 * A variation of algorithms used in [rectpack2D](https://github.com/TeamHypersomnia/rectpack2D)
 * and [bin-pack](https://github.com/bryanburgers/bin-pack), which are in turn based 
 * on [this article by Blackpawn](http://blackpawn.com/texts/lightmaps/default.html).
 * 
 * @license
 * ISC License
 * 
 * Copyright (c) 2018, Mapbox
 * 
 * Permission to use, copy, modify, and/or distribute this software for any purpose
 * with or without fee is hereby granted, provided that the above copyright notice
 * and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
 * REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND
 * FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
 * INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS
 * OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
 * TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF
 * THIS SOFTWARE.
 */
function(e){let t=0,s=0;for(const i of e)t+=i.w*i.h,s=Math.max(s,i.w);e.sort(((e,t)=>t.h-e.h));const n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),s),h:1/0}];let a=0,r=0;for(const i of e)for(let e=n.length-1;e>=0;e--){const t=n[e];if(!(i.w>t.w||i.h>t.h)){if(i.x=t.x,i.y=t.y,r=Math.max(r,i.y+i.h),a=Math.max(a,i.x+i.w),i.w===t.w&&i.h===t.h){const t=n.pop();e<n.length&&(n[e]=t)}else i.h===t.h?(t.x+=i.w,t.w-=i.w):i.w===t.w?(t.y+=i.h,t.h-=i.h):(n.push({x:t.x+i.w,y:t.y,w:t.w-i.w,h:i.h}),t.y+=i.h,t.h-=i.h);break}}return{w:a,h:r,fill:t/(a*r)||0}}(this.uv_boxes);this.uv_boxes.forEach((n=>{const a=e[n.index].geometry.getAttribute("uv").clone();for(let e=0;e<a.array.length;e+=a.itemSize)a.array[e]=(a.array[e]+n.x+t)/s.w,a.array[e+1]=(a.array[e+1]+n.y+t)/s.h;e[n.index].geometry.setAttribute("uv2",a),e[n.index].geometry.getAttribute("uv2").needsUpdate=!0}))}update(e,t=100,s=!0){if(null==this.blurringPlane)return;const n=this.renderer.getRenderTarget();this.blurringPlane.visible=s;for(let i=0;i<this.lightMapContainers.length;i++)this.lightMapContainers[i].object.oldScene=this.lightMapContainers[i].object.parent,this.scene.attach(this.lightMapContainers[i].object);this.firstUpdate&&(this.renderer.setRenderTarget(this.tinyTarget),this.renderer.render(this.scene,e),this.firstUpdate=!1);for(let i=0;i<this.lightMapContainers.length;i++)this.uvMat.uniforms.averagingWindow={value:t},this.lightMapContainers[i].object.material=this.uvMat,this.lightMapContainers[i].object.oldFrustumCulled=this.lightMapContainers[i].object.frustumCulled,this.lightMapContainers[i].object.frustumCulled=!1;const a=this.buffer1Active?this.progressiveLightMap1:this.progressiveLightMap2,r=this.buffer1Active?this.progressiveLightMap2:this.progressiveLightMap1;this.renderer.setRenderTarget(a),this.uvMat.uniforms.previousShadowMap={value:r.texture},this.blurringPlane.material.uniforms.previousShadowMap={value:r.texture},this.buffer1Active=!this.buffer1Active,this.renderer.render(this.scene,e);for(let i=0;i<this.lightMapContainers.length;i++)this.lightMapContainers[i].object.frustumCulled=this.lightMapContainers[i].object.oldFrustumCulled,this.lightMapContainers[i].object.material=this.lightMapContainers[i].basicMat,this.lightMapContainers[i].object.oldScene.attach(this.lightMapContainers[i].object);this.renderer.setRenderTarget(n)}showDebugLightmap(e,t){0!=this.lightMapContainers.length?(null==this.labelMesh&&(this.labelMaterial=new y({map:this.progressiveLightMap1.texture,side:J}),this.labelPlane=new k(100,100),this.labelMesh=new b(this.labelPlane,this.labelMaterial),this.labelMesh.position.y=250,this.lightMapContainers[0].object.parent.add(this.labelMesh)),null!=t&&this.labelMesh.position.copy(t),this.labelMesh.visible=e):this.warned||(console.warn("Call this after adding the objects!"),this.warned=!0)}_initializeBlurPlane(e,t=null){const s=new y;s.uniforms={previousShadowMap:{value:null},pixelOffset:{value:1/e},polygonOffset:!0,polygonOffsetFactor:-1,polygonOffsetUnits:3},s.onBeforeCompile=n=>{n.vertexShader="#define USE_UV\n"+n.vertexShader.slice(0,-1)+"\tgl_Position = vec4((uv - 0.5) * 2.0, 1.0, 1.0); }";const a=n.fragmentShader.indexOf("void main() {");n.fragmentShader="#define USE_UV\n"+n.fragmentShader.slice(0,a)+"\tuniform sampler2D previousShadowMap;\n\tuniform float pixelOffset;\n"+n.fragmentShader.slice(a-1,-1)+"\tgl_FragColor.rgb = (\n\t\t\t\t\t\t\t\t\ttexture2D(previousShadowMap, vUv + vec2( pixelOffset,  0.0        )).rgb +\n\t\t\t\t\t\t\t\t\ttexture2D(previousShadowMap, vUv + vec2( 0.0        ,  pixelOffset)).rgb +\n\t\t\t\t\t\t\t\t\ttexture2D(previousShadowMap, vUv + vec2( 0.0        , -pixelOffset)).rgb +\n\t\t\t\t\t\t\t\t\ttexture2D(previousShadowMap, vUv + vec2(-pixelOffset,  0.0        )).rgb +\n\t\t\t\t\t\t\t\t\ttexture2D(previousShadowMap, vUv + vec2( pixelOffset,  pixelOffset)).rgb +\n\t\t\t\t\t\t\t\t\ttexture2D(previousShadowMap, vUv + vec2(-pixelOffset,  pixelOffset)).rgb +\n\t\t\t\t\t\t\t\t\ttexture2D(previousShadowMap, vUv + vec2( pixelOffset, -pixelOffset)).rgb +\n\t\t\t\t\t\t\t\t\ttexture2D(previousShadowMap, vUv + vec2(-pixelOffset, -pixelOffset)).rgb)/8.0;\n\t\t\t\t}",n.uniforms.previousShadowMap={value:t.texture},n.uniforms.pixelOffset={value:.5/e},s.uniforms=n.uniforms,s.userData.shader=n,this.compiled=!0},this.blurringPlane=new b(new k(1,1),s),this.blurringPlane.name="Blurring Plane",this.blurringPlane.frustumCulled=!1,this.blurringPlane.renderOrder=0,this.blurringPlane.material.depthWrite=!1,this.scene.add(this.blurringPlane)}}class lt{constructor(e,{origin:t=new T(5,5,5),target:s=new T(0,1,0),center:n=new T(0,0,0),shadowMapResolution:a=512,lightMapResolution:r=1024,lightsCount:i=8,ambientWeight:o=.5,blendWindow:l=200,lightRadius:c=50}={}){this.center=n,this.origin=t,this.target=s,this.ambientWeight=o,this.blendWindow=l,this.lightRadius=c,this.progressiveSurfacemap=new ot(e,r),this.lights=[],this.helpers=this.buildHelpers();for(let h=0;h<i;h++){const e=new ee(16777215,1/i);e.name="Dir. Light "+h,e.castShadow=!0,e.target.position.copy(s),e.shadow.mapSize.width=a,e.shadow.mapSize.height=a,this.lights.push(e)}this.progressiveSurfacemap.addObjectsToLightMap(this.lights)}buildHelpers(){(new N).add(new te(this.target.clone().sub(this.origin).normalize(),this.origin,this.target.clone().sub(this.origin).length(),16776960,0,0),new se((new ne).setFromCenterAndSize(this.origin,new T(1,1,1)),16776960),new se((new ne).setFromCenterAndSize(this.target,new T(.5,.5,.5)),16776960))}add(e){Array.isArray(e)||(object=[e]),this.progressiveSurfacemap.addObjectsToLightMap(e)}render(e){this.progressiveSurfacemap.update(e,this.blendWindow,!0);for(let t=0;t<this.lights.length;t++)if(Math.random()>this.ambientWeight)this.lights[t].position.set(this.origin.x+Math.random()*this.lightRadius,this.origin.y+Math.random()*this.lightRadius,this.origin.z+Math.random()*this.lightRadius);else{const e=Math.acos(2*Math.random()-1)-1.570795,s=6.28318*Math.random();this.lights[t].position.set(Math.cos(e)*Math.cos(s)*300+this.center.x,Math.abs(Math.cos(e)*Math.sin(s)*300)+this.center.y+20,300*Math.sin(e)+this.center.z)}}}class ct extends ae{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new mt(e)})),this.register((function(e){return new gt(e)})),this.register((function(e){return new vt(e)})),this.register((function(e){return new ft(e)})),this.register((function(e){return new dt(e)})),this.register((function(e){return new wt(e)}))}load(e,t,s,n){const a=this;let r;r=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:re.extractUrlBase(e),this.manager.itemStart(e);const i=function(t){n?n(t):console.error(t),a.manager.itemError(e),a.manager.itemEnd(e)},o=new ie(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(s){try{a.parse(s,r,(function(s){t(s),a.manager.itemEnd(e)}),i)}catch(n){i(n)}}),s,i)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,s,n){let a;const r={},i={};if("string"==typeof e)a=e;else{if(re.decodeText(new Uint8Array(e,0,4))===xt){try{r[ut.KHR_BINARY_GLTF]=new Mt(e)}catch(c){return void(n&&n(c))}a=r[ut.KHR_BINARY_GLTF].content}else a=re.decodeText(new Uint8Array(e))}const o=JSON.parse(a);if(void 0===o.asset||o.asset.version[0]<2)return void(n&&n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const l=new Jt(o,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let h=0;h<this.pluginCallbacks.length;h++){const e=this.pluginCallbacks[h](l);i[e.name]=e,r[e.name]=!0}if(o.extensionsUsed)for(let h=0;h<o.extensionsUsed.length;++h){const e=o.extensionsUsed[h],t=o.extensionsRequired||[];switch(e){case ut.KHR_MATERIALS_UNLIT:r[e]=new pt;break;case ut.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:r[e]=new Rt;break;case ut.KHR_DRACO_MESH_COMPRESSION:r[e]=new Tt(o,this.dracoLoader);break;case ut.KHR_TEXTURE_TRANSFORM:r[e]=new Et;break;case ut.KHR_MESH_QUANTIZATION:r[e]=new At;break;default:t.indexOf(e)>=0&&void 0===i[e]&&console.warn('THREE.GLTFLoader: Unknown extension "'+e+'".')}}l.setExtensions(r),l.setPlugins(i),l.parse(s,n)}}function ht(){let e={};return{get:function(t){return e[t]},add:function(t,s){e[t]=s},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const ut={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class dt{constructor(e){this.parser=e,this.name=ut.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let s=0,n=t.length;s<n;s++){const n=t[s];n.extensions&&n.extensions[this.name]&&void 0!==n.extensions[this.name].light&&e._addNodeRef(this.cache,n.extensions[this.name].light)}}_loadLight(e){const t=this.parser,s="light:"+e;let n=t.cache.get(s);if(n)return n;const a=t.json,r=((a.extensions&&a.extensions[this.name]||{}).lights||[])[e];let i;const o=new C(16777215);void 0!==r.color&&o.fromArray(r.color);const l=void 0!==r.range?r.range:0;switch(r.type){case"directional":i=new ee(o),i.target.position.set(0,0,-1),i.add(i.target);break;case"point":i=new x(o),i.distance=l;break;case"spot":i=new oe(o),i.distance=l,r.spot=r.spot||{},r.spot.innerConeAngle=void 0!==r.spot.innerConeAngle?r.spot.innerConeAngle:0,r.spot.outerConeAngle=void 0!==r.spot.outerConeAngle?r.spot.outerConeAngle:Math.PI/4,i.angle=r.spot.outerConeAngle,i.penumbra=1-r.spot.innerConeAngle/r.spot.outerConeAngle,i.target.position.set(0,0,-1),i.add(i.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+r.type)}return i.position.set(0,0,0),i.decay=2,void 0!==r.intensity&&(i.intensity=r.intensity),i.name=t.createUniqueName(r.name||"light_"+e),n=Promise.resolve(i),t.cache.add(s,n),n}createNodeAttachment(e){const t=this,s=this.parser,n=s.json.nodes[e],a=(n.extensions&&n.extensions[this.name]||{}).light;return void 0===a?null:this._loadLight(a).then((function(e){return s._getNodeRef(t.cache,a,e)}))}}class pt{constructor(){this.name=ut.KHR_MATERIALS_UNLIT}getMaterialType(){return y}extendParams(e,t,s){const n=[];e.color=new C(1,1,1),e.opacity=1;const a=t.pbrMetallicRoughness;if(a){if(Array.isArray(a.baseColorFactor)){const t=a.baseColorFactor;e.color.fromArray(t),e.opacity=t[3]}void 0!==a.baseColorTexture&&n.push(s.assignTexture(e,"map",a.baseColorTexture))}return Promise.all(n)}}class mt{constructor(e){this.parser=e,this.name=ut.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?le:null}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const a=[],r=n.extensions[this.name];if(void 0!==r.clearcoatFactor&&(t.clearcoat=r.clearcoatFactor),void 0!==r.clearcoatTexture&&a.push(s.assignTexture(t,"clearcoatMap",r.clearcoatTexture)),void 0!==r.clearcoatRoughnessFactor&&(t.clearcoatRoughness=r.clearcoatRoughnessFactor),void 0!==r.clearcoatRoughnessTexture&&a.push(s.assignTexture(t,"clearcoatRoughnessMap",r.clearcoatRoughnessTexture)),void 0!==r.clearcoatNormalTexture&&(a.push(s.assignTexture(t,"clearcoatNormalMap",r.clearcoatNormalTexture)),void 0!==r.clearcoatNormalTexture.scale)){const e=r.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new P(e,-e)}return Promise.all(a)}}class ft{constructor(e){this.parser=e,this.name=ut.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?le:null}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const a=[],r=n.extensions[this.name];return void 0!==r.transmissionFactor&&(t.transmission=r.transmissionFactor),void 0!==r.transmissionTexture&&a.push(s.assignTexture(t,"transmissionMap",r.transmissionTexture)),Promise.all(a)}}class gt{constructor(e){this.parser=e,this.name=ut.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,s=t.json,n=s.textures[e];if(!n.extensions||!n.extensions[this.name])return null;const a=n.extensions[this.name],r=s.images[a.source],i=t.options.ktx2Loader;if(!i){if(s.extensionsRequired&&s.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,r,i)}}class vt{constructor(e){this.parser=e,this.name=ut.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,s=this.parser,n=s.json,a=n.textures[e];if(!a.extensions||!a.extensions[t])return null;const r=a.extensions[t],i=n.images[r.source];let o=s.textureLoader;if(i.uri){const e=s.options.manager.getHandler(i.uri);null!==e&&(o=e)}return this.detectSupport().then((function(a){if(a)return s.loadTextureImage(e,i,o);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return s.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class wt{constructor(e){this.name=ut.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,s=t.bufferViews[e];if(s.extensions&&s.extensions[this.name]){const e=s.extensions[this.name],n=this.parser.getDependency("buffer",e.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([n,a.ready]).then((function(t){const s=e.byteOffset||0,n=e.byteLength||0,r=e.count,i=e.byteStride,o=new ArrayBuffer(r*i),l=new Uint8Array(t[0],s,n);return a.decodeGltfBuffer(new Uint8Array(o),r,i,l,e.mode,e.filter),o}))}return null}}const xt="glTF",bt=1313821514,yt=5130562;class Mt{constructor(e){this.name=ut.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12);if(this.header={magic:re.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==xt)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-12,n=new DataView(e,12);let a=0;for(;a<s;){const t=n.getUint32(a,!0);a+=4;const s=n.getUint32(a,!0);if(a+=4,s===bt){const s=new Uint8Array(e,12+a,t);this.content=re.decodeText(s)}else if(s===yt){const s=12+a;this.body=e.slice(s,s+t)}a+=t}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Tt{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=ut.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const s=this.json,n=this.dracoLoader,a=e.extensions[this.name].bufferView,r=e.extensions[this.name].attributes,i={},o={},l={};for(const c in r){const e=jt[c]||c.toLowerCase();i[e]=r[c]}for(const c in e.attributes){const t=jt[c]||c.toLowerCase();if(void 0!==r[c]){const n=s.accessors[e.attributes[c]],a=It[n.componentType];l[t]=a,o[t]=!0===n.normalized}}return t.getDependency("bufferView",a).then((function(e){return new Promise((function(t){n.decodeDracoFile(e,(function(e){for(const t in e.attributes){const s=e.attributes[t],n=o[t];void 0!==n&&(s.normalized=n)}t(e)}),i,l)}))}))}}class Et{constructor(){this.name=ut.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class St extends v{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;const t=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),s=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),n=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),a=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),r=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),i={specular:{value:(new C).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=i,this.onBeforeCompile=function(e){for(const t in i)e.uniforms[t]=i[t];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",s).replace("#include <roughnessmap_fragment>",n).replace("#include <metalnessmap_fragment>",a).replace("#include <lights_physical_fragment>",r)},Object.defineProperties(this,{specular:{get:function(){return i.specular.value},set:function(e){i.specular.value=e}},specularMap:{get:function(){return i.specularMap.value},set:function(e){i.specularMap.value=e,e?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return i.glossiness.value},set:function(e){i.glossiness.value=e}},glossinessMap:{get:function(){return i.glossinessMap.value},set:function(e){i.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class Rt{constructor(){this.name=ut.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}getMaterialType(){return St}extendParams(e,t,s){const n=t.extensions[this.name];e.color=new C(1,1,1),e.opacity=1;const a=[];if(Array.isArray(n.diffuseFactor)){const t=n.diffuseFactor;e.color.fromArray(t),e.opacity=t[3]}if(void 0!==n.diffuseTexture&&a.push(s.assignTexture(e,"map",n.diffuseTexture)),e.emissive=new C(0,0,0),e.glossiness=void 0!==n.glossinessFactor?n.glossinessFactor:1,e.specular=new C(1,1,1),Array.isArray(n.specularFactor)&&e.specular.fromArray(n.specularFactor),void 0!==n.specularGlossinessTexture){const t=n.specularGlossinessTexture;a.push(s.assignTexture(e,"glossinessMap",t)),a.push(s.assignTexture(e,"specularMap",t))}return Promise.all(a)}createMaterial(e){const t=new St(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=ce,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}}class At{constructor(){this.name=ut.KHR_MESH_QUANTIZATION}}class Pt extends Ce{constructor(e,t,s,n){super(e,t,s,n)}copySampleValue_(e){const t=this.resultBuffer,s=this.sampleValues,n=this.valueSize,a=e*n*3+n;for(let r=0;r!==n;r++)t[r]=s[a+r];return t}}Pt.prototype.beforeStart_=Pt.prototype.copySampleValue_,Pt.prototype.afterEnd_=Pt.prototype.copySampleValue_,Pt.prototype.interpolate_=function(e,t,s,n){const a=this.resultBuffer,r=this.sampleValues,i=this.valueSize,o=2*i,l=3*i,c=n-t,h=(s-t)/c,u=h*h,d=u*h,p=e*l,m=p-l,f=-2*d+3*u,g=d-u,v=1-f,w=g-u+h;for(let x=0;x!==i;x++){const e=r[m+x+i],t=r[m+x+o]*c,s=r[p+x+i],n=r[p+x]*c;a[x]=v*e+w*t+f*s+g*n}return a};const _t=0,Lt=1,Ct=2,Ot=3,Ut=4,Dt=5,kt=6,It={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Nt={9728:p,9729:u,9984:Oe,9985:Ue,9986:De,9987:pe},Ft={33071:ke,33648:Ie,10497:me},Ht={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},jt={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Bt={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Gt={CUBICSPLINE:void 0,LINEAR:Se,STEP:Ne},zt="OPAQUE",Yt="MASK",Kt="BLEND";function Vt(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}function Wt(e,t,s){for(const n in s.extensions)void 0===e[n]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[n]=s.extensions[n])}function Xt(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function qt(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let s=0,n=t.weights.length;s<n;s++)e.morphTargetInfluences[s]=t.weights[s];if(t.extras&&Array.isArray(t.extras.targetNames)){const s=t.extras.targetNames;if(e.morphTargetInfluences.length===s.length){e.morphTargetDictionary={};for(let t=0,n=s.length;t<n;t++)e.morphTargetDictionary[s[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Zt(e){const t=e.extensions&&e.extensions[ut.KHR_DRACO_MESH_COMPRESSION];let s;return s=t?"draco:"+t.bufferView+":"+t.indices+":"+$t(t.attributes):e.indices+":"+$t(e.attributes)+":"+e.mode,s}function $t(e){let t="";const s=Object.keys(e).sort();for(let n=0,a=s.length;n<a;n++)t+=s[n]+":"+e[s[n]]+";";return t}function Qt(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class Jt{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new ht,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.textureCache={},this.nodeNamesUsed={},"undefined"!=typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?this.textureLoader=new he(this.options.manager):this.textureLoader=new ue(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new ie(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const s=this,n=this.json,a=this.extensions;this.cache.removeAll(),this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([s.getDependencies("scene"),s.getDependencies("animation"),s.getDependencies("camera")])})).then((function(t){const r={scene:t[0][n.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:n.asset,parser:s,userData:{}};Wt(a,r,n),Xt(r,n),Promise.all(s._invokeAll((function(e){return e.afterRoot&&e.afterRoot(r)}))).then((function(){e(r)}))})).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],s=this.json.meshes||[];for(let n=0,a=t.length;n<a;n++){const s=t[n].joints;for(let t=0,n=s.length;t<n;t++)e[s[t]].isBone=!0}for(let n=0,a=e.length;n<a;n++){const t=e[n];void 0!==t.mesh&&(this._addNodeRef(this.meshCache,t.mesh),void 0!==t.skin&&(s[t.mesh].isSkinnedMesh=!0)),void 0!==t.camera&&this._addNodeRef(this.cameraCache,t.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,s){if(e.refs[t]<=1)return s;const n=s.clone();return n.name+="_instance_"+e.uses[t]++,n}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let s=0;s<t.length;s++){const n=e(t[s]);if(n)return n}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const s=[];for(let n=0;n<t.length;n++){const a=e(t[n]);a&&s.push(a)}return s}getDependency(e,t){const s=e+":"+t;let n=this.cache.get(s);if(!n){switch(e){case"scene":n=this.loadScene(t);break;case"node":n=this.loadNode(t);break;case"mesh":n=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":n=this.loadAccessor(t);break;case"bufferView":n=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":n=this.loadBuffer(t);break;case"material":n=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":n=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":n=this.loadSkin(t);break;case"animation":n=this.loadAnimation(t);break;case"camera":n=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(s,n)}return n}getDependencies(e){let t=this.cache.get(e);if(!t){const s=this,n=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(n.map((function(t,n){return s.getDependency(e,n)}))),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],s=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[ut.KHR_BINARY_GLTF].body);const n=this.options;return new Promise((function(e,a){s.load(Vt(t.uri,n.path),e,void 0,(function(){a(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){const s=t.byteLength||0,n=t.byteOffset||0;return e.slice(n,n+s)}))}loadAccessor(e){const t=this,s=this.json,n=this.json.accessors[e];if(void 0===n.bufferView&&void 0===n.sparse)return Promise.resolve(null);const a=[];return void 0!==n.bufferView?a.push(this.getDependency("bufferView",n.bufferView)):a.push(null),void 0!==n.sparse&&(a.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),a.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(a).then((function(e){const a=e[0],r=Ht[n.type],i=It[n.componentType],o=i.BYTES_PER_ELEMENT,l=o*r,c=n.byteOffset||0,h=void 0!==n.bufferView?s.bufferViews[n.bufferView].byteStride:void 0,u=!0===n.normalized;let d,p;if(h&&h!==l){const e=Math.floor(c/h),s="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+e+":"+n.count;let l=t.cache.get(s);l||(d=new i(a,e*h,n.count*h/o),l=new de(d,h/o),t.cache.add(s,l)),p=new He(l,r,c%h/o,u)}else d=null===a?new i(n.count*r):new i(a,c,n.count*r),p=new $(d,r,u);if(void 0!==n.sparse){const t=Ht.SCALAR,s=It[n.sparse.indices.componentType],o=n.sparse.indices.byteOffset||0,l=n.sparse.values.byteOffset||0,c=new s(e[1],o,n.sparse.count*t),h=new i(e[2],l,n.sparse.count*r);null!==a&&(p=new $(p.array.slice(),p.itemSize,p.normalized));for(let e=0,n=c.length;e<n;e++){const t=c[e];if(p.setX(t,h[e*r]),r>=2&&p.setY(t,h[e*r+1]),r>=3&&p.setZ(t,h[e*r+2]),r>=4&&p.setW(t,h[e*r+3]),r>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return p}))}loadTexture(e){const t=this.json,s=this.options,n=t.textures[e],a=t.images[n.source];let r=this.textureLoader;if(a.uri){const e=s.manager.getHandler(a.uri);null!==e&&(r=e)}return this.loadTextureImage(e,a,r)}loadTextureImage(e,t,s){const n=this,a=this.json,r=this.options,i=a.textures[e],o=(t.uri||t.bufferView)+":"+i.sampler;if(this.textureCache[o])return this.textureCache[o];const c=self.URL||self.webkitURL;let h=t.uri||"",d=!1,p=!0;const m=h.search(/\.jpe?g($|\?)/i)>0||0===h.search(/^data\:image\/jpeg/);if(("image/jpeg"===t.mimeType||m)&&(p=!1),void 0!==t.bufferView)h=n.getDependency("bufferView",t.bufferView).then((function(e){if("image/png"===t.mimeType){const t=new DataView(e,25,1).getUint8(0,!1);p=6===t||4===t||3===t}d=!0;const s=new Blob([e],{type:t.mimeType});return h=c.createObjectURL(s),h}));else if(void 0===t.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const f=Promise.resolve(h).then((function(e){return new Promise((function(t,n){let a=t;!0===s.isImageBitmapLoader&&(a=function(e){t(new je(e))}),s.load(Vt(e,r.path),a,void 0,n)}))})).then((function(t){!0===d&&c.revokeObjectURL(h),t.flipY=!1,i.name&&(t.name=i.name),p||(t.format=l);const s=(a.samplers||{})[i.sampler]||{};return t.magFilter=Nt[s.magFilter]||u,t.minFilter=Nt[s.minFilter]||pe,t.wrapS=Ft[s.wrapS]||me,t.wrapT=Ft[s.wrapT]||me,n.associations.set(t,{type:"textures",index:e}),t}));return this.textureCache[o]=f,f}assignTexture(e,t,s){const n=this;return this.getDependency("texture",s.index).then((function(a){if(void 0===s.texCoord||0==s.texCoord||"aoMap"===t&&1==s.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+s.texCoord+" for texture "+t+" not yet supported."),n.extensions[ut.KHR_TEXTURE_TRANSFORM]){const e=void 0!==s.extensions?s.extensions[ut.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=n.associations.get(a);a=n.extensions[ut.KHR_TEXTURE_TRANSFORM].extendTexture(a,e),n.associations.set(a,t)}}e[t]=a}))}assignFinalMaterial(e){const t=e.geometry;let s=e.material;const n=void 0!==t.attributes.tangent,a=void 0!==t.attributes.color,r=void 0===t.attributes.normal,i=Object.keys(t.morphAttributes).length>0,o=i&&void 0!==t.morphAttributes.normal;if(e.isPoints){const e="PointsMaterial:"+s.uuid;let t=this.cache.get(e);t||(t=new fe,ge.prototype.copy.call(t,s),t.color.copy(s.color),t.map=s.map,t.sizeAttenuation=!1,this.cache.add(e,t)),s=t}else if(e.isLine){const e="LineBasicMaterial:"+s.uuid;let t=this.cache.get(e);t||(t=new ve,ge.prototype.copy.call(t,s),t.color.copy(s.color),this.cache.add(e,t)),s=t}if(n||a||r||i){let e="ClonedMaterial:"+s.uuid+":";s.isGLTFSpecularGlossinessMaterial&&(e+="specular-glossiness:"),n&&(e+="vertex-tangents:"),a&&(e+="vertex-colors:"),r&&(e+="flat-shading:"),i&&(e+="morph-targets:"),o&&(e+="morph-normals:");let t=this.cache.get(e);t||(t=s.clone(),a&&(t.vertexColors=!0),r&&(t.flatShading=!0),i&&(t.morphTargets=!0),o&&(t.morphNormals=!0),n&&(t.vertexTangents=!0,t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(s))),s=t}s.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",t.attributes.uv),e.material=s}getMaterialType(){return v}loadMaterial(e){const t=this,s=this.json,n=this.extensions,a=s.materials[e];let r;const i={},o=a.extensions||{},l=[];if(o[ut.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const e=n[ut.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];r=e.getMaterialType(),l.push(e.extendParams(i,a,t))}else if(o[ut.KHR_MATERIALS_UNLIT]){const e=n[ut.KHR_MATERIALS_UNLIT];r=e.getMaterialType(),l.push(e.extendParams(i,a,t))}else{const s=a.pbrMetallicRoughness||{};if(i.color=new C(1,1,1),i.opacity=1,Array.isArray(s.baseColorFactor)){const e=s.baseColorFactor;i.color.fromArray(e),i.opacity=e[3]}void 0!==s.baseColorTexture&&l.push(t.assignTexture(i,"map",s.baseColorTexture)),i.metalness=void 0!==s.metallicFactor?s.metallicFactor:1,i.roughness=void 0!==s.roughnessFactor?s.roughnessFactor:1,void 0!==s.metallicRoughnessTexture&&(l.push(t.assignTexture(i,"metalnessMap",s.metallicRoughnessTexture)),l.push(t.assignTexture(i,"roughnessMap",s.metallicRoughnessTexture))),r=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),l.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,i)}))))}!0===a.doubleSided&&(i.side=J);const c=a.alphaMode||zt;return c===Kt?(i.transparent=!0,i.depthWrite=!1):(i.transparent=!1,c===Yt&&(i.alphaTest=void 0!==a.alphaCutoff?a.alphaCutoff:.5)),void 0!==a.normalTexture&&r!==y&&(l.push(t.assignTexture(i,"normalMap",a.normalTexture)),i.normalScale=new P(1,-1),void 0!==a.normalTexture.scale&&i.normalScale.set(a.normalTexture.scale,-a.normalTexture.scale)),void 0!==a.occlusionTexture&&r!==y&&(l.push(t.assignTexture(i,"aoMap",a.occlusionTexture)),void 0!==a.occlusionTexture.strength&&(i.aoMapIntensity=a.occlusionTexture.strength)),void 0!==a.emissiveFactor&&r!==y&&(i.emissive=(new C).fromArray(a.emissiveFactor)),void 0!==a.emissiveTexture&&r!==y&&l.push(t.assignTexture(i,"emissiveMap",a.emissiveTexture)),Promise.all(l).then((function(){let s;return s=r===St?n[ut.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(i):new r(i),a.name&&(s.name=a.name),s.map&&(s.map.encoding=we),s.emissiveMap&&(s.emissiveMap.encoding=we),Xt(s,a),t.associations.set(s,{type:"materials",index:e}),a.extensions&&Wt(n,s,a),s}))}createUniqueName(e){const t=xe.sanitizeNodeName(e||"");let s=t;for(let n=1;this.nodeNamesUsed[s];++n)s=t+"_"+n;return this.nodeNamesUsed[s]=!0,s}loadGeometries(e){const t=this,s=this.extensions,n=this.primitiveCache;function a(e){return s[ut.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(s){return ts(s,e,t)}))}const r=[];for(let i=0,o=e.length;i<o;i++){const s=e[i],o=Zt(s),l=n[o];if(l)r.push(l.promise);else{let e;e=s.extensions&&s.extensions[ut.KHR_DRACO_MESH_COMPRESSION]?a(s):ts(new Z,s,t),n[o]={primitive:s,promise:e},r.push(e)}}return Promise.all(r)}loadMesh(e){const t=this,s=this.json,n=this.extensions,a=s.meshes[e],r=a.primitives,i=[];for(let l=0,c=r.length;l<c;l++){const e=void 0===r[l].material?(void 0===(o=this.cache).DefaultMaterial&&(o.DefaultMaterial=new v({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Fe})),o.DefaultMaterial):this.getDependency("material",r[l].material);i.push(e)}var o;return i.push(t.loadGeometries(r)),Promise.all(i).then((function(s){const i=s.slice(0,s.length-1),o=s[s.length-1],l=[];for(let h=0,u=o.length;h<u;h++){const s=o[h],c=r[h];let u;const d=i[h];if(c.mode===Ut||c.mode===Dt||c.mode===kt||void 0===c.mode)u=!0===a.isSkinnedMesh?new be(s,d):new b(s,d),!0!==u.isSkinnedMesh||u.geometry.attributes.skinWeight.normalized||u.normalizeSkinWeights(),c.mode===Dt?u.geometry=ss(u.geometry,Be):c.mode===kt&&(u.geometry=ss(u.geometry,Le));else if(c.mode===Lt)u=new ye(s,d);else if(c.mode===Ot)u=new Me(s,d);else if(c.mode===Ct)u=new Te(s,d);else{if(c.mode!==_t)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+c.mode);u=new Ee(s,d)}Object.keys(u.geometry.morphAttributes).length>0&&qt(u,a),u.name=t.createUniqueName(a.name||"mesh_"+e),Xt(u,a),c.extensions&&Wt(n,u,c),t.assignFinalMaterial(u),l.push(u)}if(1===l.length)return l[0];const c=new N;for(let e=0,t=l.length;e<t;e++)c.add(l[e]);return c}))}loadCamera(e){let t;const s=this.json.cameras[e],n=s[s.type];if(n)return"perspective"===s.type?t=new O(X.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):"orthographic"===s.type&&(t=new I(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),s.name&&(t.name=this.createUniqueName(s.name)),Xt(t,s),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],s={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(s):this.getDependency("accessor",t.inverseBindMatrices).then((function(e){return s.inverseBindMatrices=e,s}))}loadAnimation(e){const t=this.json.animations[e],s=[],n=[],a=[],r=[],i=[];for(let o=0,l=t.channels.length;o<l;o++){const e=t.channels[o],l=t.samplers[e.sampler],c=e.target,h=void 0!==c.node?c.node:c.id,u=void 0!==t.parameters?t.parameters[l.input]:l.input,d=void 0!==t.parameters?t.parameters[l.output]:l.output;s.push(this.getDependency("node",h)),n.push(this.getDependency("accessor",u)),a.push(this.getDependency("accessor",d)),r.push(l),i.push(c)}return Promise.all([Promise.all(s),Promise.all(n),Promise.all(a),Promise.all(r),Promise.all(i)]).then((function(s){const n=s[0],a=s[1],r=s[2],i=s[3],o=s[4],l=[];for(let e=0,t=n.length;e<t;e++){const t=n[e],s=a[e],c=r[e],h=i[e],u=o[e];if(void 0===t)continue;let d;switch(t.updateMatrix(),t.matrixAutoUpdate=!0,Bt[u.path]){case Bt.weights:d=Ye;break;case Bt.rotation:d=ze;break;case Bt.position:case Bt.scale:default:d=Ge}const p=t.name?t.name:t.uuid,m=void 0!==h.interpolation?Gt[h.interpolation]:Se,f=[];Bt[u.path]===Bt.weights?t.traverse((function(e){!0===e.isMesh&&e.morphTargetInfluences&&f.push(e.name?e.name:e.uuid)})):f.push(p);let g=c.array;if(c.normalized){const e=Qt(g.constructor),t=new Float32Array(g.length);for(let s=0,n=g.length;s<n;s++)t[s]=g[s]*e;g=t}for(let e=0,n=f.length;e<n;e++){const t=new d(f[e]+"."+Bt[u.path],s.array,g,m);"CUBICSPLINE"===h.interpolation&&(t.createInterpolant=function(e){return new Pt(this.times,this.values,this.getValueSize()/3,e)},t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),l.push(t)}}const c=t.name?t.name:"animation_"+e;return new Re(c,void 0,l)}))}createNodeMesh(e){const t=this.json,s=this,n=t.nodes[e];return void 0===n.mesh?null:s.getDependency("mesh",n.mesh).then((function(e){const t=s._getNodeRef(s.meshCache,n.mesh,e);return void 0!==n.weights&&t.traverse((function(e){if(e.isMesh)for(let t=0,s=n.weights.length;t<s;t++)e.morphTargetInfluences[t]=n.weights[t]})),t}))}loadNode(e){const t=this.json,s=this.extensions,n=this,a=t.nodes[e],r=a.name?n.createUniqueName(a.name):"";return function(){const t=[],s=n._invokeOne((function(t){return t.createNodeMesh&&t.createNodeMesh(e)}));return s&&t.push(s),void 0!==a.camera&&t.push(n.getDependency("camera",a.camera).then((function(e){return n._getNodeRef(n.cameraCache,a.camera,e)}))),n._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){t.push(e)})),Promise.all(t)}().then((function(t){let i;if(i=!0===a.isBone?new Ae:t.length>1?new N:1===t.length?t[0]:new Pe,i!==t[0])for(let e=0,s=t.length;e<s;e++)i.add(t[e]);if(a.name&&(i.userData.name=a.name,i.name=r),Xt(i,a),a.extensions&&Wt(s,i,a),void 0!==a.matrix){const e=new K;e.fromArray(a.matrix),i.applyMatrix4(e)}else void 0!==a.translation&&i.position.fromArray(a.translation),void 0!==a.rotation&&i.quaternion.fromArray(a.rotation),void 0!==a.scale&&i.scale.fromArray(a.scale);return n.associations.set(i,{type:"nodes",index:e}),i}))}loadScene(e){const t=this.json,s=this.extensions,n=this.json.scenes[e],a=this,r=new N;n.name&&(r.name=a.createUniqueName(n.name)),Xt(r,n),n.extensions&&Wt(s,r,n);const i=n.nodes||[],o=[];for(let l=0,c=i.length;l<c;l++)o.push(es(i[l],r,t,a));return Promise.all(o).then((function(){return r}))}}function es(e,t,s,n){const a=s.nodes[e];return n.getDependency("node",e).then((function(e){if(void 0===a.skin)return e;let t;return n.getDependency("skin",a.skin).then((function(e){t=e;const s=[];for(let a=0,r=t.joints.length;a<r;a++)s.push(n.getDependency("node",t.joints[a]));return Promise.all(s)})).then((function(s){return e.traverse((function(e){if(!e.isMesh)return;const n=[],a=[];for(let r=0,i=s.length;r<i;r++){const e=s[r];if(e){n.push(e);const s=new K;void 0!==t.inverseBindMatrices&&s.fromArray(t.inverseBindMatrices.array,16*r),a.push(s)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[r])}e.bind(new _e(n,a),e.matrixWorld)})),e}))})).then((function(e){t.add(e);const r=[];if(a.children){const t=a.children;for(let a=0,i=t.length;a<i;a++){const i=t[a];r.push(es(i,e,s,n))}}return Promise.all(r)}))}function ts(e,t,s){const n=t.attributes,a=[];function r(t,n){return s.getDependency("accessor",t).then((function(t){e.setAttribute(n,t)}))}for(const i in n){const t=jt[i]||i.toLowerCase();t in e.attributes||a.push(r(n[i],t))}if(void 0!==t.indices&&!e.index){const n=s.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));a.push(n)}return Xt(e,t),function(e,t,s){const n=t.attributes,a=new ne;if(void 0===n.POSITION)return;{const e=s.json.accessors[n.POSITION],t=e.min,r=e.max;if(void 0===t||void 0===r)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(a.set(new T(t[0],t[1],t[2]),new T(r[0],r[1],r[2])),e.normalized){const t=Qt(It[e.componentType]);a.min.multiplyScalar(t),a.max.multiplyScalar(t)}}const r=t.targets;if(void 0!==r){const e=new T,t=new T;for(let n=0,a=r.length;n<a;n++){const a=r[n];if(void 0!==a.POSITION){const n=s.json.accessors[a.POSITION],r=n.min,i=n.max;if(void 0!==r&&void 0!==i){if(t.setX(Math.max(Math.abs(r[0]),Math.abs(i[0]))),t.setY(Math.max(Math.abs(r[1]),Math.abs(i[1]))),t.setZ(Math.max(Math.abs(r[2]),Math.abs(i[2]))),n.normalized){const e=Qt(It[n.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}a.expandByVector(e)}e.boundingBox=a;const i=new Ke;a.getCenter(i.center),i.radius=a.min.distanceTo(a.max)/2,e.boundingSphere=i}(e,t,s),Promise.all(a).then((function(){return void 0!==t.targets?function(e,t,s){let n=!1,a=!1;for(let o=0,l=t.length;o<l;o++){const e=t[o];if(void 0!==e.POSITION&&(n=!0),void 0!==e.NORMAL&&(a=!0),n&&a)break}if(!n&&!a)return Promise.resolve(e);const r=[],i=[];for(let o=0,l=t.length;o<l;o++){const l=t[o];if(n){const t=void 0!==l.POSITION?s.getDependency("accessor",l.POSITION):e.attributes.position;r.push(t)}if(a){const t=void 0!==l.NORMAL?s.getDependency("accessor",l.NORMAL):e.attributes.normal;i.push(t)}}return Promise.all([Promise.all(r),Promise.all(i)]).then((function(t){const s=t[0],r=t[1];return n&&(e.morphAttributes.position=s),a&&(e.morphAttributes.normal=r),e.morphTargetsRelative=!0,e}))}(e,t.targets,s):e}))}function ss(e,t){let s=e.getIndex();if(null===s){const t=[],n=e.getAttribute("position");if(void 0===n)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<n.count;e++)t.push(e);e.setIndex(t),s=e.getIndex()}const n=s.count-2,a=[];if(t===Le)for(let i=1;i<=n;i++)a.push(s.getX(0)),a.push(s.getX(i)),a.push(s.getX(i+1));else for(let i=0;i<n;i++)i%2==0?(a.push(s.getX(i)),a.push(s.getX(i+1)),a.push(s.getX(i+2))):(a.push(s.getX(i+2)),a.push(s.getX(i+1)),a.push(s.getX(i)));a.length/3!==n&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const r=e.clone();return r.setIndex(a),r}var ns=new class extends M{constructor(){super(),this._queue=[],this._store={},this._renderer=null}get TYPES(){return{File:"File",Image:"Image",Texture:"Texture",HDRI:"HDRI",GLTF:"GLTF"}}get LOADERS(){return{[this.TYPES.File]:new ie,[this.TYPES.Texture]:new ue,[this.TYPES.HDRI]:new We,[this.TYPES.GLTF]:new ct}}setRenderer(e){this._renderer=e}queue(e,t,s){this._queue.push({url:e,key:t||e.split("\\").pop().split("/").pop().split(".").pop(),type:s||this.TYPES.File})}async process({url:e,key:t,type:s}){if(this.has(t))return;const n=this.LOADERS[s];switch(s){case this.TYPES.File:n.responseType="blob",await new Promise((s=>n.load(e,(e=>{this._store[t]=URL.createObjectURL(e),s()}))));break;case this.TYPES.Image:const s=new Image;await new Promise((t=>{s.onload=t,s.src=e})),this._store[t]=s;break;case this.TYPES.Texture:case this.TYPES.HDRI:const a=await n.loadAsync(e);this._renderer?this._renderer.initTexture(a):console.warn("AssetStore.process(): A texture is being processed but no renderer is set","call setRenderer() to allow the AssetLoader instance to decode the texture","on the GPU during the loading process and avoid first-render lags"),this._store[t]=a;break;case this.TYPES.GLTF:const r=await n.loadAsync(e);this._store[t]=r}return this._store[t]}async load(){await Promise.all(this._queue.map((async e=>{await this.process(e),console.debug("AssetStore.load(): "+e.key),this.dispatchEvent({type:"progress",current:Object.keys(this._store).length,total:this._queue.length})}))),this.dispatchEvent({type:"loaded"}),this._queue=[]}get(e){if(this.has(e))return this._store[e];throw`AssetStore.get() : asset with key ${e} not found in loaded assets`}has(e){return e in this._store}};ns.queue("./assets/Loewe_C.6e7176f5.glb","Loewe_C",ns.TYPES.GLTF),ns.queue("./assets/Pferdestatue_C.5177dfd7.glb","Pferdestatue_C",ns.TYPES.GLTF),ns.queue("./assets/Engel_C.123fd656.glb","Engel_C",ns.TYPES.GLTF),ns.queue(tt,"envmap",ns.TYPES.HDRI);const as={BlurredReflectorExample:class extends et{start(){this.camera.position.set(10,8,10),this.torus=new b(new B,new G),this.torus.position.set(2,3,-2),this.scene.add(this.torus),this.icos=new b(new z(2),new G),this.icos.position.set(-2,3,2),this.scene.add(this.icos);const e=new k(32,32),t=new b(e,new G({depthWrite:!1}));t.rotateX(-Math.PI/2),this.scene.add(t),this.reflector=new it({opacity:1,blur:2}),this.scene.add(this.reflector)}update(e,t){this.icos.rotation.set(t/2,t/2,t/2),this.torus.rotation.set(t/2,t/2,t/2)}get parameters(){return{opacity:{label:"Opacity",value:this.reflector.opacity,min:0,max:1,onChange:e=>this.reflector.opacity=e},blur:{label:"Blur",value:this.reflector.blur,min:0,max:8,onChange:e=>this.reflector.blur=e},fast:{label:"Use fast blur",value:this.reflector.fastBlur,onChange:e=>this.reflector.fastBlur=e}}}},ContactShadowsExample:class extends et{start(){this.camera.position.set(10,10,10),this.controls.target.set(0,2,0),this.torus=new b(new B,new G),this.torus.position.set(2,4,-2),this.scene.add(this.torus),this.icos=new b(new z(2),new G),this.icos.position.set(-2,4,2),this.scene.add(this.icos);const e=new b(new k(32,32),new G);e.rotation.x=-Math.PI/2,this.scene.add(e),this.contactShadows=new at({}),this.contactShadows.position.y=.01,this.scene.add(this.contactShadows.helpers),this.scene.add(this.contactShadows)}update(e,t){this.icos.rotation.set(t/2,t/2,t/2),this.icos.position.y=Math.sin(t)+4,this.torus.rotation.set(t/2,t/2,t/2),this.torus.position.y=Math.sin(Math.PI+t)+4}get parameters(){return{darkness:{label:"Darkness",value:this.contactShadows.darkness,min:.5,max:1.5,onChange:e=>this.contactShadows.darkness=e},opacity:{label:"Opacity",value:this.contactShadows.opacity,min:0,max:1,onChange:e=>this.contactShadows.opacity=e},blur:{label:"Blur",value:this.contactShadows.blur,min:0,max:16,onChange:e=>this.contactShadows.blur=e},fastBlur:{label:"Use fast blur",value:this.contactShadows.fastBlur,onChange:e=>this.contactShadows.fastBlur=e},helpers:{label:"Show helpers",value:this.contactShadows.helpers.parent===this.scene,onChange:e=>{e?this.scene.add(this.contactShadows.helpers):this.scene.remove(this.contactShadows.helpers)}}}}},EnvironmentExample:class extends et{async start(){this.camera.position.z=10,this.torus=new b(new U(1,.5,16,32),new v({roughness:.4,metalness:.6})),this.scene.add(this.torus),this.scene.background=this.defaultBackground=new C(.8,.8,.8),this.texture=await(new We).loadAsync(tt),this.environment=new Xe(this.renderer,this.scene)}update(e,t){this.torus.rotation.set(t/2,t/2,t/2)}get parameters(){return{texture:{label:"Use texture",value:this.scene.environment===this.texture,onChange:e=>{this.environment.apply({texture:e?this.texture:null,equirectangular:e,background:!(this.scene.background instanceof C)})}},background:{label:"Set background",value:!(this.scene.background instanceof C),onChange:e=>this.scene.background=e?this.scene.environment:this.defaultBackground}}}},ProgressiveShadowsExample:class extends et{start(){this.camera.position.set(6,10,16),this.controls.target.set(0,2,0),this.renderer.shadowMap.enabled=!0;const e=new b(new B(2,.75,128,24),new Q);e.position.set(2,4,-2),e.castShadow=!0,e.receiveShadow=!0,this.scene.add(e);const t=new b(new z(2),new Q);t.position.set(-2,2,2),t.castShadow=!0,t.receiveShadow=!0,this.scene.add(t);const s=new b(new k(32,32),new Q);s.rotation.x=-Math.PI/2,this.scene.add(s),this.progressiveShadows=new lt(this.renderer,{origin:new T(5,10,5),target:new T(0,1,0),center:new T(0,0,0),shadowMapResolution:512,lightMapResolution:1024,lightsCount:8,ambientWeight:.5,blendWindow:200,lightRadius:20}),this.progressiveShadows.add([s,e,t]),this.scene.add(this.progressiveShadows.helpers)}update(e,t){this.progressiveShadows.render(this.camera)}get parameters(){return{}}},AssetLoaderExample:class extends et{async start(){this.renderer.outputEncoding=we,this.camera.position.set(-20,5,0),this.controls.target.set(0,5,0);const e=new b(new k(128,128),new v);e.rotation.x=-Math.PI/2,this.scene.add(e),this.scene.fog=new Ve(16777215,32,64);const t=document.createElement("div");Object.assign(t.style,{position:"absolute",width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",background:"black",color:"white",fontFamily:"monospace",fontSize:"xx-large",textAlign:"center",transition:"opacity 500ms ease",pointerEvents:"none"});const s=document.createElement("p");t.append(s),document.body.prepend(t),ns.addEventListener("progress",(({current:e,total:t})=>{const n=(e/t*100).toFixed(0).padStart(3,"0");s.innerHTML=`${n}<br>(${e}/${t})`})),ns.addEventListener("loaded",(async()=>{await new Promise((e=>setTimeout(e,500))),t.style.opacity=0})),await ns.load();const n=ns.get("envmap");new Xe(this.renderer,this.scene,{texture:n,equirectangular:!0,background:!1});const a=ns.get("Loewe_C");this.scene.add(a.scene);const r=ns.get("Pferdestatue_C");r.scene.position.set(0,0,8),this.scene.add(r.scene);const i=ns.get("Engel_C");i.scene.position.set(0,0,-8),this.scene.add(i.scene)}}},rs={example:window.location.hash.replace("#","")},is=new Tweakpane.Pane;if(is.addInput(rs,"example",{label:"Example",options:Object.keys(as).reduce(((e,t)=>(e[t]=t,e)),{})}).on("change",(e=>{window.location.hash=e.value,window.location.reload()})),rs.example){const e=is.addFolder({title:"Parameters"});new as[rs.example]({gui:e})}
